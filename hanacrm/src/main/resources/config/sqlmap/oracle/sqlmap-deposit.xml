<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="deposit.DepositDAO">

<!-- resultMap 설정 시작 -->
	<resultMap type="deposit" id="depositMap">
		<result column="dcls_month" property="dclsMonth"/>
		<result column="fin_co_no" property="finCoNo"/>
		<result column="kor_co_nm" property="korCoNm"/>
		<result column="fin_prdt_cd" property="finPrdtCd"/>
		<result column="fin_prdt_nm" property="finPrdtNm"/>
		<result column="join_way" property="joinWay"/>
		<result column="mtrt_int" property="mtrtInt"/>
		<result column="spcl_cnd" property="spclCnd"/>
		<result column="join_deny" property="joinDeny"/>
		<result column="join_member" property="joinMember"/>
		<result column="etc_note" property="etcNote"/>
		<result column="max_limit" property="maxLimit"/>
		<result column="dcls_strt_day" property="dclsStrtDay"/>
		<result column="dcls_end_day" property="dclsEndDay"/>
		<result column="fin_co_subm_day" property="finCoSubmDay"/>
	</resultMap>		
<!-- resultMap 설정 끝 -->

<!-- 쿼리 -->	
	<select id="selectList" resultMap="depositMap">
		select * from deposit_info
	</select>
	
	<select id="selectByNo" parameterType="int" resultMap="depositMap">
		select no, to_char(dcls_month, 'YYYY-MM') as dcls_month, fin_co_no, kor_co_nm, fin_prdt_cd, fin_prdt_nm, join_way, mtrt_int, spcl_cnd, join_deny, join_member, etc_note, max_limit, to_char(dcls_strt_day, 'YYYY-MM-DD') as dcls_strt_day, to_char(dcls_end_day, 'YYYY-MM-DD') as dcls_end_day, to_char(fin_co_subm_day, 'YYYY-MM-DD hh24:mi') as fin_co_subm_day from deposit_info where no=#{no}
	</select>
	
	<select id="selectLog" resultType="String">
		select ipv6 from deposit_log where to_char(reg_date, 'yyyy-mm-dd')=to_char(sysdate, 'yyyy-mm-dd')
	</select>
	
	<insert id="insert" parameterType="deposit">
		insert into deposit_info values(deposit_info_seq.nextval, to_date(#{dclsMonth},'YYYY/MM'),#{finCoNo},#{korCoNm},#{finPrdtCd},#{finPrdtNm},#{joinWay},#{mtrtInt, jdbcType=VARCHAR},#{spclCnd, jdbcType=VARCHAR},#{joinDeny, jdbcType=NUMERIC},#{joinMember, jdbcType=VARCHAR},#{etcNote, jdbcType=VARCHAR},#{maxLimit, jdbcType=NUMERIC},to_date(#{dclsStrtDay, jdbcType=DATE},'YYYY/MM/DD'),to_date(#{dclsEndDay},'YYYY/MM/DD'),to_date(#{finCoSubmDay},'YYYY/MM/DD HH24:MI:SS'))
	</insert>
	
	<select id="selectName" parameterType="int" resultType="string">
		select FIN_PRDT_NM from deposit_info where no=#{no}
	</select>	
	
	<!-- deposit 상담 많은 상품 3 -->
	<select id="selectTop" resultType="main">
		select di.no as no, replace(di.fin_prdt_nm, chr(13)||chr(10), ' ') as name, count
		from (select product_no, count(*) as count
				from consult_product
				group by type, product_no
				having type = 1
				order by count desc, product_no desc)
			 join deposit_info di on (di.no = product_no)
		where rownum <![CDATA[ <= ]]> 3
	</select>
</mapper>